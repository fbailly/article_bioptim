The purpose of \textit{bioptim} is to solve a variety of biomechanical OCPs with minimal user effort and high performances in terms of computational time. 
The main features illustrated by the six provided examples are (Tab.~X): 
\textit{i)} the possibility to use torque-, activation- or excitation-driven models (and their combinations);
\textit{ii)} a variety of ready-to-use cost functions, constraints and dynamics (with and without contacts)...;
\textit{iii)} ... easily customizable in Python when required by the user;
\textit{iv)} the possibility to solve advanced OCPs (possibly multi-phased) in a few seconds or minutes, that were previously known to take hours; 
\textit{v)} the interface with two different NLP solvers.
In the following, several aspects of \textit{bioptim} are discussed.

\subsection{Direct multiple shooting-based}

While the debate remains about the performances of direct collocations versus DMS \cite{diehl2006fast}\hl{[donner d'autres favorables a DC]}, the development of \textit{bioptim} was oriented toward DMS, because: \textit{i)} it allows to select effortlessly an arbitrary accuracy for the integration (e.g., number of RK steps); \textit{ii)} it allows to use DMS-based fast NLP solvers such as \textit{acados}.
Concerning the integration, either internally or via \textit{acados}, several schemes are implemented in \textit{bioptim} (RK4, RK8, IRK).
While IRK showed better convergence in our experience with hard problems in \textit{acados}, in most of the cases, RK4 showed to be a good speed/robustness trade-off. 
In contrast to what is claimed in several papers [\addref], DMS is not a limitation to the performances (cost value and time to convergence), since the performances of \textit{bioptim} often outperform state-of-the-art results.

\subsection{Automatic differentiation}

One of the reasons explaining the performances of \textit{bioptim} is the rewriting of the core software, \textit{RBDL} and \textit{biorbd} implementing the dynamics, into \textit{casadi} symbolics for automatically providing the exact Jacobians and Hessians of the resulting NLP.  
This feature is somewhat more computationally expensive than finite differences, but the gain in precision for the calculation of derivatives often leads to shorter convergence times (due to much less iterations) and to optimal solutions reached with lower tolerances.
This last aspect must be emphasized for complex motions (fast, highly dynamics ones), because talking about \textit{ipopt} for instance, an optimal solution obtained with a convergence criterion of $1e-2$ is very unlikely to be dynamically consistent (it would diverge when forward integrating the controls in a single-shooting manner), whereas a lower tolerance ($1e-6$. $1e-8$) only reachable with exact derivatives could lead to better forward dynamics results.

\subsection{Python based but fast!}

\textit{bioptim} was thought as an interface, and was therefore written in Python to allow the user to easily combine existing cost functions or constraints and self-implemented ones, to switch from one solver to another, etc. 
We believe this feature to be of importance given that the biomechanics community is known to be mainly made of software users rather than developers.
Therefore, providing a custom interface in Python rather than in, e.g., C++ [MOCO], was a driving objective of our work.
But since flexibility and ease-of-use should not compromise the performances, all the inside computations are expressed as C++ CasAdi graphs, interfaced with C++ NLP solvers.
These graphs can either be built in \texttt{casadi.MX()} or \texttt{casadi.SX()}.
\textit{acados} requires the latter, needing more RAM for building the problem but being faster to solve, whereas both options are available when using \textit{ipopt}. 
Inspired by the  real-time graphics from \textit{MUSCOD-II} \hl{[ref]}, \textit{bioptim} proposes a series of online-generated figures to analyze the iterations of the solvers with  minimal computational cost thanks to a \hl{XXX} protocole. 
Our implementation leverages the \textit{Python pickle} library for easily saving and loading OCPs for, e.g., post-processing analysis.

\subsection{Fast vs robust NLP solvers}

Fast solvers, such as \textit{acados}, offer the opportunity to use multi-start approaches on complex problems in order to circumvent the obstacle of local minima \cite{huchez2015local, bailly2020optimal} or to get meaningful initial solutions from simpler problems, for guiding the resolution of the harder problems.
On the other hands, robust solvers, such as \textit{ipopt}, are convenient when the user lacks information about the sought solutions and thus cannot guide the solver through a good initial guess.
For biomechanics applications, the complementary characteristics of the interfaced solvers is a really useful tool.

\subsection{Multiphase}

Biomechanics studies often face changing dynamics due to the loss or gain of contact or \hl{XXX}.
When tracking such a motion or trying to predict it, these dynamics changes translate into multi-phase OCP.
This is currently one of the drawbacks of \textit{moco}, which does not provide this feature.
\textit{bioptim}, however, is able to handle multi-phase OCPs, although they can currently only be solved with ipopt (see Ex. \hl{XXX} and \hl{XXX}).


\subsection{Cost vs constraints … relâcher le problème simplement}

\hl{???}

\subsection{Limitations}

Bioptim is already a mature solution for solving biomechanical OCP, however some limitations should be raised. 
First, it is based on  \textit{biorbd} which is actively maintained, fast and CasADi-compatible for automatic differentiation, but which is not as advanced as OpenSim or Anybody in terms of biomechanical features and audience. 
The variety of proposed examples highlighted simple to advanced models.
Even if defining a new model was made straightforward thanks to the \texttt{.bioMod} file format, \textit{biorbd} does not include a GUI for building models. 
Some Opensim models can be translated into \texttt{.bioMod} \hl{[LINK]} but our library does not yet support multiple wrapping objects, non-orthogonal DoFs between two bodies, compliant contact force models (e.g. [SmoothSphereHalfSpaceForce [52]]) or muscle-tendon equilibrium. 
As seen in \textit{Moco}, wrapping objects are rare due to computational cost and required optimization when a line of action is in contact with more than one object. 
Via points [\addref] and pre-processed moment arms (to be expressed as polynomial functions of crossed DoFs) are often preferred. 
\hl{In example X, the model differences (Opensim vs Biorbd), especially at the knee may explain the XXXX.} 

%Algorithms available in RBDL (core of biorbd for XXX) for ellipsoid foot model XXXXX (https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6693511/).    

\subsection{Future directions}
Realtime estimation using MHE

MOOCP .. using front pareto

Prediction of adaptations due to muscular fatigue using NMPC

Muscle-tendon equilibrium and model builder are already planned and the former will either required an additional optimisation procedure to achieve the equilibrium as in CEINMS [\addref] or adding the length of muscle part with explicit constraints of XXXX in the OCP like in [\addref]. 

In line with the current studies of our research group, the future developments will first include \comment{nonlinear}{uniformiser l'écriture de ce mot} model predictive control and MHE (see example X) to predict optimal performances in repetitive tasks that generate muscular fatigue and real time estimation of joint torques and muscle forces, respectively. 
As shown in our previous studies [\addref] the analysis of a series near-optimal solutions is relevant in sport (but also in rehabilitation and ergonomics) and further efforts about multiobjective OCP of human performances are anticipated. 
